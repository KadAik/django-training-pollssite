{% extends 'authdemo/base_template.html' %}

{% load str_parse_datetime %}

{% block 'title' %}
    Home
{% endblock %}

{% block content %}
    <div id="timer">
        <div id="days">..</div>
        <div id="hours">..</div>
        <div id="minutes">..</div>
        <div id="seconds">60</div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function (){

        function countdown(targetDate) {
            // Get the timer field and update it
            const daysTag = document.getElementById("days");
            const hourstag = document.getElementById("hours");
            const minutesTag = document.getElementById("minutes");
            const secondsTag = document.getElementById("seconds");

            function updateCountdown(){
                // Calculate the time left and update the UI
                let now = new Date().getTime();
                let timeRemaining = targetDate - now;

                // Format timeRemaining timestamp to days:hours:minutes:seconds
                // Note the timestamp is the number of milliseconds since January 1st, 1970

                const days = Math.floor(timeRemaining/(1000*60*60*24));
                const hours = Math.floor((timeRemaining%(1000*3600*24)) / (1000*60*60));
                const minutes = Math.floor((timeRemaining%(1000*60*60)) / (1000*60));
                const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
        
                //countdownTag.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;

                daysTag.textContent = `${days}d`;
                hourstag.textContent = `${hours}h`;
                minutesTag.textContent = `${minutes}m`;
                secondsTag.textContent = `${seconds}s`;

                if (timeRemaining <= 0){
                    clearInterval(interval);
                    document.getElementById("timer").textContent = "Session expired";
                }
            }

            const interval = setInterval(updateCountdown, 1000);

        }

        // Initialize the countdown with the max_age from cookies
        const maxAge = "{{ request.COOKIES.maxAge|default:"Empty" }}";
        if (maxAge){
            // Launch the countdown
            let maxAge_date = new Date(maxAge).getTime();
            countdown(maxAge_date);
        }
           
        })

    </script>

{% endblock %}

